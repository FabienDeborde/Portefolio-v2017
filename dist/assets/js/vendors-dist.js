!function(e,t){"function"==typeof define&&define.amd?define([],t(e)):"object"==typeof exports?module.exports=t(e):e.gumshoe=t(e)}("undefined"!=typeof global?global:this.window||this.global,function(e){"use strict";var t,n,o,i,r,a,s,c={},l="querySelector"in document&&"addEventListener"in e&&"classList"in document.createElement("_"),u=[],d={selector:"[data-gumshoe] a",selectorHeader:"[data-gumshoe-header]",container:e,offset:0,activeClass:"active",scrollDelay:!1,callback:function(){}},f=function(e,t,n){if("[object Object]"===Object.prototype.toString.call(e))for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(n,e[o],o,e);else for(var i=0,r=e.length;i<r;i++)t.call(n,e[i],i,e)},h=function(){var e={},t=!1,n=0,o=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],n++);for(var i=function(n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t&&"[object Object]"===Object.prototype.toString.call(n[o])?e[o]=h(!0,e[o],n[o]):e[o]=n[o])};n<o;n++){var r=arguments[n];i(r)}return e},m=function(e){return Math.max(e.scrollHeight,e.offsetHeight,e.clientHeight)},g=function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)},p=function(e){var n=0;if(e.offsetParent){do n+=e.offsetTop,e=e.offsetParent;while(e)}else n=e.offsetTop;return n=n-r-t.offset,n>=0?n:0},v=function(t){var n=t.getBoundingClientRect();return n.top>=0&&n.left>=0&&n.bottom<=(e.innerHeight||document.documentElement.clientHeight)&&n.right<=(e.innerWidth||document.documentElement.clientWidth)},y=function(){u.sort(function(e,t){return e.distance>t.distance?-1:e.distance<t.distance?1:0})};c.setDistances=function(){o=g(),r=i?m(i)+p(i):0,f(u,function(e){e.distance=p(e.target)}),y()};var b=function(){var e=document.querySelectorAll(t.selector);f(e,function(e){if(e.hash){var t=document.querySelector(e.hash);t&&u.push({nav:e,target:t,parent:"li"===e.parentNode.tagName.toLowerCase()?e.parentNode:null,distance:0})}})},S=function(){a&&(a.nav.classList.remove(t.activeClass),a.parent&&a.parent.classList.remove(t.activeClass))},$=function(e){S(),e.nav.classList.add(t.activeClass),e.parent&&e.parent.classList.add(t.activeClass),t.callback(e),a={nav:e.nav,parent:e.parent}};c.getCurrentNav=function(){var n=e.pageYOffset;if(e.innerHeight+n>=o&&v(u[0].target))return $(u[0]),u[0];for(var i=0,r=u.length;i<r;i++){var a=u[i];if(a.distance<=n)return $(a),a}S(),t.callback()};var C=function(){f(u,function(e){e.nav.classList.contains(t.activeClass)&&(a={nav:e.nav,parent:e.parent})})};c.destroy=function(){t&&(t.container.removeEventListener("resize",L,!1),t.container.removeEventListener("scroll",L,!1),u=[],t=null,n=null,o=null,i=null,r=null,a=null,s=null)};var w=function(){window.clearTimeout(n),n=setTimeout(function(){c.setDistances(),c.getCurrentNav()},66)},L=function(e){n||(n=setTimeout(function(){n=null,"scroll"===e.type&&c.getCurrentNav(),"resize"===e.type&&(c.setDistances(),c.getCurrentNav())},66))};return c.init=function(e){l&&(c.destroy(),t=h(d,e||{}),i=document.querySelector(t.selectorHeader),b(),0!==u.length&&(C(),c.setDistances(),c.getCurrentNav(),t.container.addEventListener("resize",L,!1),t.scrollDelay?t.container.addEventListener("scroll",w,!1):t.container.addEventListener("scroll",L,!1)))},c});